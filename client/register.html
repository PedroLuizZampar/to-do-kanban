<!doctype html>
<html lang="pt-br">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Cadastro - Kanban de Tarefas</title>
		<link rel="icon" href="/favicon.svg" type="image/svg+xml" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
		<link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/auth.css" />
	</head>
	<body>
		<main class="auth-container">
			<div class="auth-card">
				<div class="auth-logo">
					<span class="material-symbols-outlined" aria-hidden="true">view_kanban</span>
					<h1>Kanban</h1>
				</div>
				<h2>Cadastro</h2>
				<div id="register-error" class="auth-error hidden"></div>
				<form id="register-form" class="auth-form">
					<div class="auth-field">
						<label for="username">Nome de Usuário</label>
						<input type="text" id="username" name="username" required autocomplete="username" />
					</div>
                    <div class="auth-field">
						<label for="email">Email</label>
						<input type="email" id="email" name="email" required autocomplete="email" />
					</div>
					<div class="auth-field">
						<label for="password">Senha</label>
						<input type="password" id="password" name="password" required autocomplete="new-password" />
					</div>
                    <div class="auth-field">
						<label for="confirm_password">Confirmar Senha</label>
						<input type="password" id="confirm_password" name="confirm_password" required autocomplete="new-password" />
					</div>
					<button type="submit" class="auth-button">Cadastrar</button>
				</form>
				<p class="auth-footer">
					Já tem uma conta? <a href="login.html">Entrar</a>
				</p>
			</div>
		</main>

        <div id="toast" class="toast hidden"></div>
		<script src="/js/auth.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', () => {
                // Se usuário já estiver logado, redireciona para a página inicial
                if (window.$auth.isAuthenticated()) {
                    window.location.href = '/';
                    return;
                }
                
                // Função para mostrar erro
                function showError(message) {
                    const errorEl = document.getElementById('register-error');
                    errorEl.textContent = message;
                    errorEl.classList.remove('hidden');
                }
                
                // Form de registro
                const registerForm = document.getElementById('register-form');
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirm_password').value;
                    
                    // Valida campos
                    if (!username) return showError('Nome de usuário é obrigatório');
                    if (!email) return showError('Email é obrigatório');
                    if (!password) return showError('Senha é obrigatória');
                    if (password !== confirmPassword) return showError('Senhas não conferem');
                    if (password.length < 6) return showError('Senha deve ter pelo menos 6 caracteres');
                    
                    try {
                        await window.$auth.register(username, email, password);
                        window.location.href = '/';
                    } catch (e) {
                        showError(e.message || 'Erro ao criar conta');
                    }
                });
            });
		</script>
	</body>
</html>
